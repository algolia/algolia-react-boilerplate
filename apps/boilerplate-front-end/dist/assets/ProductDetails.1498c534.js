import{r as i,P as le,g as ue,h as F,k as me,l as ne,m as pe,j as r,F as he,n as ae,v as fe,o as ve,p as be,q as G,t as ge,x as A,y as E,R as C,z as xe,B,D as z,e as M,a as d,E as L,G as w,H as U,I as re,J as se,K as ye,M as Pe,N as _e,O as Se,Q as oe,S as Oe,T as Ne,U as Ce,V as Ie,W as je,X as Te,c as we,w as De,Y as ke,Z as R,$ as Re,a0 as T,a1 as J,a2 as Fe,a3 as Ae,a4 as Ze,a5 as X}from"./index.0541b32f.js";var Ee={current:0};function Be(e){var t=e.id,n=e.name,a=e.active,s=a===void 0?!0:a,l=e.happened,f=l===void 0?!1:l,u={id:t||"".concat(n,"-").concat(++Ee.current),name:n,active:s,happened:f};return u}var Ve=i.exports.createContext(null);function ie(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.errorMessage;var t=i.exports.useContext(le);return ue(t!==null),t}function $e(e){var t=i.exports.useState(function(){return e}),n=F(t,2),a=n[0],s=n[1];return me(a,e)||s(e),a}var He=["addZone","removeZone","updateZone","subscribe"];function ce(){var e=ie({errorMessage:"`usePredict()` must be used within the <Predict> provider."});e.addZone,e.removeZone,e.updateZone,e.subscribe;var t=ne(e,He),n=$e(t);return n}var qe=["id","children","name","segment","fallback"];function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,a)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Y(Object(n),!0).forEach(function(a){ae(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}function ze(e){var t=e.id,n=e.children,a=e.name,s=e.segment,l=e.fallback,f=l===void 0?null:l,u=ne(e,qe),v=ie({errorMessage:"The <PredictZone> must be mounted within the <Predict> provider."}),b=v.addZone,c=v.removeZone,m=v.updateZone,g=ce(),O=i.exports.useState(function(){var x=typeof s=="function"?s(g):s?Boolean(g.segments.find(function(_){return _.name===s})):!0;return Be({id:t,name:a,active:x})}),p=F(O,2),o=p[0],y=p[1],S=i.exports.useState(!1),I=F(S,2),V=I[0],$=I[1],H=i.exports.useState(o.name),Z=F(H,2),W=Z[0],q=Z[1];if(a!==W&&(q(a),m({id:o.id,name:a})),!V){var D=typeof s=="function"?s(g):s?Boolean(g.segments.find(function(x){return x.name===s})):o.active;D!==o.active&&(y(function(x){return N(N({},x),{},{active:D})}),m({id:o.id,active:D}))}var k=i.exports.useMemo(function(){return{dismissZone:function(){y(function(_){return N(N({},_),{},{active:!1,happened:!0})}),m({id:o.id,active:!1,happened:!0}),$(!0)}}},[m,o.id]),j=pe.exports.useSyncExternalStore(i.exports.useCallback(function(){return b(o),function(){c(o)}},[b,c]),function(){return k},function(){return k});return o.active?r(Ve.Provider,{value:j,children:r("div",{...u,"data-predictzoneid":o.id,onMouseDown:function(){y(function(_){return N(N({},_),{},{happened:!0})}),m({id:o.id,happened:!0})},onTouchStart:function(){y(function(_){return N(N({},_),{},{happened:!0})}),m({id:o.id,happened:!0})},children:n})}):r(he,{children:f})}function Me(e){var t=e.objectIDs,n=e.recommendClient,a=e.transformItems,s=a===void 0?function(c){return c}:a,l=e.indexName,f=e.maxRecommendations,u=e.queryParameters,v=e.threshold,b=t.map(function(c){return{indexName:l,maxRecommendations:f,objectID:c,queryParameters:u,threshold:v}});return n.addAlgoliaAgent("recommend-core",fe),n.getFrequentlyBoughtTogether(b).then(function(c){return ve({maxRecommendations:f,hits:c.results.map(function(m){return m.hits}),nrOfObjs:t.length})}).then(function(c){return{recommendations:s(c)}})}function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,a)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ee(Object(n),!0).forEach(function(a){ae(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}function Le(e){var t=e.indexName,n=e.maxRecommendations,a=e.objectIDs,s=e.queryParameters,l=e.recommendClient,f=e.threshold,u=e.transformItems,v=i.exports.useState({recommendations:[]}),b=F(v,2),c=b[0],m=b[1],g=be("loading"),O=g.status,p=g.setStatus,o=G(a),y=G(s);ge({recommendClient:l});var S=i.exports.useRef(u);return i.exports.useEffect(function(){S.current=u},[u]),i.exports.useEffect(function(){p("loading"),Me({indexName:t,maxRecommendations:n,objectIDs:o,queryParameters:y,recommendClient:l,threshold:f,transformItems:S.current}).then(function(I){m(I),p("idle")})},[t,n,o,y,l,p,f]),te(te({},c),{},{status:O})}function Ue({cartValue:e,valueToAdd:t}){return r("div",{className:"promotionCodeBanner",children:r("p",{children:"\u{1F389} 10% Discount applied!"})})}const We=e=>{const{price:t}=U;let n=0;return e.map(a=>(n+=w(a,t),n)),n.toFixed(2)},Ke=e=>{const{t}=M("translation",{keyPrefix:"pdp"});return t("fbtButtonAdd")[e.length-1]},Qe=({items:e,currentCartTotal:t,totalFbtProductsAmount:n})=>{const a=A(E),s=C(xe),[l,f]=i.exports.useState(0),[u,v]=i.exports.useState(!1),[b,c]=i.exports.useState(!1),[m,g]=B(z);i.exports.useEffect(()=>f(We(e)),[e]);const{t:O}=M("translation",{keyPrefix:"pdp"}),{orderValue:p}=ce();i.exports.useEffect(()=>{o()&&!u?v(!0):u&&v(!1)},[t]);const o=()=>{const y=t>p;return console.log("current cart value",t.toFixed(2),`
total if all recommendations purchased`,(t+n).toFixed(2),`
predicted order value`,p),t>p?console.log(`The current cart total, plus the FBT recommendation would be within 5% of less of the predicted order value.
In this case, the user might need an incentive, so we give 10% off if they add all the FBT items to cart`):t+n>p-p*.05&&console.log("The current cart total is already over the predicted order value, this user definately needs an incentive, we offer the 10% off the combination of the FBT recommendations"),y||t+n>p-p*.05};return d("div",{className:"fbt-infos",children:[r(ze,{name:"Free shipping banner",when:o,children:r(Ue,{cartValue:t,valueToAdd:n})}),d("div",{className:"fbt-infos__price",children:[d("p",{children:[O("addFbtTotal"),": "]}),d("p",{children:[s,u?(l-l*.1).toFixed(2):l]})]}),d("a",{className:b?"fbt-infos__btn fbt-infos__btn-active":"fbt-infos__btn",onClick:y=>{y.stopPropagation(),e.map(S=>a(S)),c(!0),g(!m),setTimeout(()=>c(!1),300)},children:[r(L,{}),r("p",{children:Ke(e)})]})]})},Ge=({item:e,index:t})=>{const n=re(),a=A(se),{image:s,category:l,productName:f,objectID:u,brand:v}=U,b=C(ye),[c,m]=i.exports.useState(!1),[g,O]=B(z),p=A(E);return d("div",{className:"fbt-component",children:[d("div",{className:"relatedItem",children:[d("div",{className:"relatedItem__imgWrapper",onClick:()=>{a(e),n(`/search/product/${e[u]}`),Pe(e[u])},children:[r("img",{src:e[s],loading:"lazy",alt:e[l]}),r("div",{className:"relatedItem__imgWrapper__heart",children:r(_e,{})})]}),d("div",{className:"relatedItem__infos",children:[d("div",{className:"relatedItem__infosUp",children:[r("p",{className:"brand",children:e[v]}),r("h3",{className:"productName",children:r(Se,{hit:e,attribute:f})})]}),d("div",{className:"item__infos-down",children:[r("p",{className:"price",children:r(oe,{hit:e})}),b&&r("div",{className:c?"cart cart-active":"cart",onClick:o=>{o.stopPropagation(),m(!0),p(e),O(!g),setTimeout(()=>m(!1),300)},children:r(L,{})})]})]})]}),r("div",{className:"fbt-component__plus-icon",children:r(Oe,{})})]})},Xe=()=>{var Q;const[e,t]=i.exports.useState(!1),n=Ne(),a=C(Ce),[s,l]=B(se),[f,u]=B(z),[v,b]=i.exports.useState(!1),c=n.pathname.split("/")[3];i.exports.useEffect(()=>{Object.keys(s).length===0?Ie.initIndex(a).search("",{facetFilters:`objectID:${c}`}).then(({hits:P})=>{P.length&&P.length>0&&(l(P[0]),b(!0))}):b(!0)},[]);const m=C(je),g=C(Te),O=A(we);i.exports.useEffect(()=>{O(!1)},[]);const p=re(),{isDesktop:o}=C(De),y=A(E),S=C(E),[I,V]=i.exports.useState(S.reduce((h,P)=>h+=P.unformated_price,0));i.exports.useEffect(()=>{V(S.reduce((h,P)=>h+=P.unformated_price,0))},[S]);const{image:$,productName:H,brand:Z,sizeFilter:W,colour:q,colourHexa:D}=U,k=(Q=w(s,D))==null?void 0:Q.split(";")[1],{t:j}=M("translation",{keyPrefix:"pdp"});let x,_,K;if(g){const{recommendations:h}=Le({recommendClient:X,indexName:a,objectIDs:[c],maxRecommendations:2});x=h.length>0?[s,...h]:h,K=x.reduce((P,de)=>P+=de.unformated_price,0)}if(m){const{recommendations:h}=ke({recommendClient:X,indexName:a,objectIDs:[c]});_=h}return d("div",{className:`${o?"":"pdp-mobile"} pdp`,variants:R,initial:R.initial,animate:R.animate,exit:R.exit,transition:R.transition,children:[d("div",{className:`${o?"pdp__wrapper":"pdp-mobile__wrapper"}`,children:[d("div",{className:`${o?"pdp__backBtn":"pdp-mobile__backBtn"}`,onClick:()=>{p("/search")},children:[r(Re,{}),r("p",{children:j("buttonBack")})]}),r("div",{initial:{opacity:0},animate:{opacity:1,transition:{framerMotionTransition:T}},className:`${o?"pdp__left":"pdp-mobile__left"}`,children:r("div",{className:"container",initial:{height:"100%",opacity:0},animate:{x:0,width:"100%",opacity:1,transition:{delay:.2,framerMotionTransition:T}},children:r("div",{className:"imageWrapper",children:r(J.img,{whileHover:{scale:1.05},transition:T,src:w(s,$),alt:"",onError:h=>h.currentTarget.src=placeHolderError})})})}),r("div",{className:`${o?"pdp__right":"pdp-mobile__right"}`,children:d("div",{className:"pdp__right__infos",initial:{opacity:0},animate:{x:0,opacity:1,transition:{delay:.5,framerMotionTransition:T}},children:[r("p",{className:"brand",children:w(s,Z)}),r("p",{className:"name",children:w(s,H)}),d("div",{className:"color",children:[k?r("div",{style:{backgroundColor:k,width:"30px",height:"30px",borderRadius:"50%"}}):"",r("p",{children:w(s,q)})]}),Fe.sizeFilter,r(J.p,{initial:{opacity:0},animate:{opacity:1,transition:{delay:1,framerMotionTransition:T}},className:"price",children:r(oe,{hit:s})}),d("button",{className:e?"add-to-cart add-to-cart-active":"add-to-cart",onClick:h=>{h.stopPropagation(),y(s),t(!0),u(!f),setTimeout(()=>t(!1),300)},children:[r(L,{}),r("p",{children:j("addToCartButton")})]})]})})]}),v&&d("div",{className:"recommend",initial:{opacity:0},animate:{opacity:1,transition:{delay:1,framerMotionTransition:T}},children:[m&&_.length>0&&d("div",{children:[r("h3",{className:"title",children:j("relatedTitle")}),r(Ae,{itemComponent:Ze,items:_})]}),g&&x.length>1&&d("div",{className:"fbt-outer-container",children:[r("h3",{className:"title",children:j("fbtTitle")}),d("div",{className:`${o?"fbt-container":"fbt-container-mobile"}`,children:[r("div",{className:"fbt-container__component",children:x.map((h,P)=>r(Ge,{item:h,index:P},P))}),r(Qe,{totalFbtProductsAmount:K,currentCartTotal:I,items:x.slice(0,3)})]})]})]})]})};export{Xe as default};
