/*! @algolia/predict-react 1.6.1 | MIT License | Â© Algolia, Inc. and contributors | https://github.com/algolia/predict */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@algolia/predict-react"]={},e.React)}(this,(function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(t);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},u=Object.keys(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,u=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(u.push(r.value),!t||u.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return u}}(e,t)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var a={current:0};function f(e,t){if(!e)throw new Error("Invariant failed")}function s(e,t,n){var r=e&&e[t];return r?function(e){return Boolean(e.error)}(r)?n:r.value:n}function l(e){var t=[],n=e.userProfile,r=[],o=function(){return n},u=function(){return Object.entries(n.segments||{}).reduce((function(e,t){var n=t[0];return t[1].map((function(e){return{name:e,type:n}})).forEach((function(t){e.push(t)})),e}),[])},i=function(){return Object.entries(n.properties||{}).reduce((function(e,t){var n=t[0],r=t[1];return Object.entries(r||{}).map((function(e){return{name:e[0],value:e[1],type:n}})).forEach((function(t){e.push(t)})),e}),[])},c=function(){return s(n.predictions,"affinities",[])},a=function(){return s(n.predictions,"funnel_stage",[])},l=function(){return s(n.predictions,"order_value",void 0)},d=function(){return e=a(),(t=e.find((function(e){return"add_to_cart"===e.name.toLocaleLowerCase()})))&&t.probability>=Math.max.apply(null,e.map((function(e){return e.probability})))?1:0;var e,t},p=function(){return r};function v(e){t.forEach((function(t){t({eventType:e,affinities:c(),cartAbandonment:d(),funnelStage:a(),orderValue:l(),segments:u(),properties:i(),userProfile:o(),zones:p()})}))}return{getAffinities:c,getFunnelStage:a,getOrderValue:l,getCartAbandonment:d,getSegments:u,getProperties:i,getUserProfile:o,getZones:p,update:function(e){!function(e){e.userProfile&&(n=e.userProfile)}(e),v("UPDATED")},addZone:function(e){return f(!r.some((function(t){return t.id===e.id})),'Cannot add zone with ID "'.concat(e.id,'" because it already exists.')),r.push(e),v("ZONE_ADDED"),e},removeZone:function(e){var t=r.findIndex((function(t){return t.id===e.id}));f(-1!==t,'Cannot remove zone with ID "'.concat(e.id,"\" because it doesn't exist.")),r.splice(t,1),v("ZONE_REMOVED")},updateZone:function(e){var t,n,o,u=r.findIndex((function(t){return t.id===e.id}));f(-1!==u,'Cannot update zone with ID "'.concat(e.id,"\" because it doesn't exist."));var i=r[u],c={id:e.id,name:null!==(t=e.name)&&void 0!==t?t:i.name,active:null!==(n=e.active)&&void 0!==n?n:i.active,happened:null!==(o=e.happened)&&void 0!==o?o:i.happened};return r[u]=c,v("ZONE_UPDATED"),c},subscribe:function(e){return t.push(e),function(){t=t.filter((function(t){return t!==e}))}}}}var d=Object.prototype.hasOwnProperty;function p(e,t){var n,r;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((r=e.length)===t.length)for(;r--&&p(e[r],t[r]););return-1===r}if(!n||"object"==typeof e){for(n in r=0,e){if(d.call(e,n)&&++r&&!d.call(t,n))return!1;if(!(n in t)||!p(e[n],t[n]))return!1}return Object.keys(t).length===r}}return e!=e&&t!=t}var v={exports:{}},b={},y=r.default;var g="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},m=y.useState,h=y.useEffect,O=y.useLayoutEffect,P=y.useDebugValue;function j(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!g(e,n)}catch(e){return!0}}var S="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=m({inst:{value:n,getSnapshot:t}}),o=r[0].inst,u=r[1];return O((function(){o.value=n,o.getSnapshot=t,j(o)&&u({inst:o})}),[e,n,t]),h((function(){return j(o)&&u({inst:o}),e((function(){j(o)&&u({inst:o})}))}),[e]),P(n),n};b.useSyncExternalStore=void 0!==y.useSyncExternalStore?y.useSyncExternalStore:S,function(e){e.exports=b}(v);var w=t.createContext(null),E=["eventType"];function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(){return D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},D.apply(this,arguments)}var A=t.createContext(null);function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.errorMessage;var n=t.useContext(w);return f(null!==n),n}var T=["addZone","removeZone","updateZone","subscribe"];function I(){var e=C({errorMessage:"`usePredict()` must be used within the <Predict> provider."});e.addZone,e.removeZone,e.updateZone,e.subscribe;var n,r,o,i,a=u(e,T);return n=a,r=c(t.useState((function(){return n})),2),o=r[0],i=r[1],p(o,n)||i(n),o}var _=["id","children","name","segment","fallback"];function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}e.Predict=function(e){var n=e.userProfile,o=e.suppressExperimentalWarning,i=void 0!==o&&o,a=e.children,f=t.useRef(null);null===f.current&&(f.current=l({userProfile:n}));var s=c(t.useState((function(){return{userProfile:f.current.getUserProfile(),affinities:f.current.getAffinities(),funnelStage:f.current.getFunnelStage(),orderValue:f.current.getOrderValue(),cartAbandonment:f.current.getCartAbandonment(),segments:f.current.getSegments(),properties:f.current.getProperties(),zones:f.current.getZones(),addZone:f.current.addZone,removeZone:f.current.removeZone,updateZone:f.current.updateZone,subscribe:f.current.subscribe}})),2),d=s[0],b=s[1],y=c(t.useState((function(){return f.current.getUserProfile()})),2),g=y[0],m=y[1];p(n,g)||(f.current.update({userProfile:n}),m(n));var h=v.exports.useSyncExternalStore(t.useCallback((function(){return f.current.subscribe((function(e){var t=e.eventType,n=u(e,E);"ZONE_UPDATED"!==t&&b((function(e){return x(x({},e),n)}))}))}),[]),(function(){return d}),(function(){return d}));return t.useEffect((function(){}),[i]),r.default.createElement(w.Provider,{value:h},a)},e.PredictZone=function(e){var n=e.id,o=e.children,i=e.name,f=e.segment,s=e.fallback,l=void 0===s?null:s,d=u(e,_),p=C({errorMessage:"The <PredictZone> must be mounted within the <Predict> provider."}),b=p.addZone,y=p.removeZone,g=p.updateZone,m=I(),h=t.useState((function(){var e="function"==typeof f?f(m):!f||Boolean(m.segments.find((function(e){return e.name===f})));return function(e){var t=e.id,n=e.name,r=e.active,o=void 0===r||r,u=e.happened,i=void 0!==u&&u;return{id:t||"".concat(n,"-").concat(++a.current),name:n,active:o,happened:i}}({id:n,name:i,active:e})})),O=c(h,2),P=O[0],j=O[1],S=c(t.useState(!1),2),w=S[0],E=S[1],Z=c(t.useState(P.name),2),x=Z[0],T=Z[1];if(i!==x&&(T(i),g({id:P.id,name:i})),!w){var M="function"==typeof f?f(m):f?Boolean(m.segments.find((function(e){return e.name===f}))):P.active;M!==P.active&&(j((function(e){return k(k({},e),{},{active:M})})),g({id:P.id,active:M}))}var U=t.useMemo((function(){return{dismissZone:function(){j((function(e){return k(k({},e),{},{active:!1,happened:!0})})),g({id:P.id,active:!1,happened:!0}),E(!0)}}}),[g,P.id]),z=v.exports.useSyncExternalStore(t.useCallback((function(){return b(P),function(){y(P)}}),[b,y]),(function(){return U}),(function(){return U}));return P.active?r.default.createElement(A.Provider,{value:z},r.default.createElement("div",D({},d,{"data-predictzoneid":P.id,onMouseDown:function(){j((function(e){return k(k({},e),{},{happened:!0})})),g({id:P.id,happened:!0})},onTouchStart:function(){j((function(e){return k(k({},e),{},{happened:!0})})),g({id:P.id,happened:!0})}}),o)):r.default.createElement(r.default.Fragment,null,l)},e.usePredict=I,e.usePredictZone=function(){var e=t.useContext(A);return f(null!==e),e},e.version="1.6.1",Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.production.js.map
