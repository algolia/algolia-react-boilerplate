/*! @algolia/predict-react 1.4.0 | MIT License | Â© Algolia, Inc. and contributors | https://github.com/algolia/predict */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@algolia/predict-react"]={},e.React)}(this,(function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(t);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],u=!0,c=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var a={current:0};function s(e,t){if(!e){if("production"===process.env.NODE_ENV)throw new Error("Invariant failed");if("production"!==process.env.NODE_ENV)throw new Error("[Predict] ".concat("function"==typeof t?t():t))}}var f={current:{}};function d(e,t){if("production"!==process.env.NODE_ENV&&!e){var n=t.trim();if(!f.current[n]){f.current[n]=!0;var r="[Predict] ".concat(n);console.warn(r);try{throw new Error(r)}catch(e){}}}}function l(e,t,n){var r=e&&e[t];return r?function(e){return Boolean(e.error)}(r)?("production"!==process.env.NODE_ENV&&"production"!==process.env.NODE_ENV&&d(!1,r.error),n):r.value:n}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var b=function(){var e={};function t(t){var n=e[t];n&&(document.body.removeChild(n),delete e[t])}return{select:function(t,n){if(!e[n.id]){var r=t.getBoundingClientRect(),o=r.height,i=r.width,u=r.top,c=r.left,a=document.createElement("div");a.setAttribute("data-predicthighlightid",n.id);var s=v(v({},n.style),{},{top:"".concat(u,"px"),left:"".concat(c,"px"),height:"".concat(o,"px"),width:"".concat(i,"px")});Object.keys(s).forEach((function(e){a.style[e]=s[e]})),e[n.id]=a,document.body.appendChild(a)}},unselect:t,unselectAll:function(){Object.keys(e).forEach((function(e){return t(e)}))}}}();function y(e,t){var n=t.init,r=e.type,i=e.data,u={"request-init":function(){n()},"request-highlight-zone":function(e){var t=e.zoneId,n=e.params,r=document.querySelector('[data-predictzoneid="'.concat(t,'"]'));r&&b.select(r,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({id:t},n))},"request-unhighlight-zone":function(e){var t=e.zoneId;b.unselect(t)},"request-scroll-to-zone":function(e){var t=e.zoneId,n=document.querySelector('[data-predictzoneid="'.concat(t,'"]'));n&&(n.scrollIntoViewIfNeeded.bind(n)||n.scrollIntoView.bind(n))()},disconnect:function(){b.unselectAll()}},c=u[r];s(Boolean(c),'The Predict Tools event "'.concat(r,'" is not implemented.')),c(i)}var g=["eventType"];function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){window.postMessage(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({source:"predict-to-extension"},e),"*")}function E(e){var t=[],n=e.userProfile,r=[],o=function(){return n},u=function(){return Object.entries(n.segments||{}).reduce((function(e,t){var n=t[0];return t[1].map((function(e){return{name:e,type:n}})).forEach((function(t){e.push(t)})),e}),[])},c=function(){return l(n.predictions,"affinities",[])},a=function(){return l(n.predictions,"funnel_stage",[])},f=function(){return l(n.predictions,"order_value",void 0)},d=function(){return e=a(),t=e.find((function(e){return"add_to_cart"===e.name})),n=e.find((function(e){return"transaction"===e.name})),t&&n&&t.probability>n.probability?1:0;var e,t,n},p=function(){return r},v=function(e){return t.push(e),function(){t=t.filter((function(t){return t!==e}))}};function O(e){t.forEach((function(t){t({eventType:e,affinities:c(),cartAbandonment:d(),funnelStage:a(),orderValue:f(),segments:u(),userProfile:o(),zones:p()})}))}return"production"===process.env.NODE_ENV&&"true"!==process.env.PREDICT_TOOLS||"undefined"==typeof window||function(e){var t=e.version,n=e.getContext,r=e.subscribe;function o(){m({type:"init",data:{version:t,context:n()}})}o(),r((function(e){e.eventType;var n=i(e,g);m({type:"state-change",data:{version:t,context:n}})})),window.addEventListener("message",(function(e){"extension-to-predict"===e.data.source&&y(e.data,{init:o})}))}({version:"1.4.0",subscribe:v,getContext:function(){return{affinities:c(),cartAbandonment:d(),funnelStage:a(),orderValue:f(),segments:u(),userProfile:o(),zones:p()}}}),{getAffinities:c,getFunnelStage:a,getOrderValue:f,getCartAbandonment:d,getSegments:u,getUserProfile:o,getZones:p,update:function(e){e.userProfile&&(n=e.userProfile),O("UPDATED")},addZone:function(e){return r.push(e),O("ZONE_ADDED"),e},removeZone:function(e){var t=r.findIndex((function(t){return t.id===e.id}));s(-1!==t,'Cannot remove zone with ID "'.concat(e.id,"\" because it doesn't exist.")),r.splice(t,1),O("ZONE_REMOVED")},updateZone:function(e){var t,n,o,i=r.findIndex((function(t){return t.id===e.id}));s(-1!==i,'Cannot update zone with ID "'.concat(e.id,"\" because it doesn't exist."));var u=r[i],c={id:e.id,name:null!==(t=e.name)&&void 0!==t?t:u.name,active:null!==(n=e.active)&&void 0!==n?n:u.active,happened:null!==(o=e.happened)&&void 0!==o?o:u.happened};return r[i]=c,O("ZONE_UPDATED"),c},subscribe:v}}var w=Object.prototype.hasOwnProperty;function P(e,t){var n,r;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((r=e.length)===t.length)for(;r--&&P(e[r],t[r]););return-1===r}if(!n||"object"==typeof e){for(n in r=0,e){if(w.call(e,n)&&++r&&!w.call(t,n))return!1;if(!(n in t)||!P(e[n],t[n]))return!1}return Object.keys(t).length===r}}return e!=e&&t!=t}var j,S={exports:{}},_={};var D,x={};
/**
   * @license React
   * use-sync-external-store-shim.development.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */!function(e){"production"===process.env.NODE_ENV?e.exports=function(){if(j)return _;j=1;var e=r.default,t="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=e.useState,o=e.useEffect,i=e.useLayoutEffect,u=e.useDebugValue;function c(e){var n=e.getSnapshot;e=e.value;try{var r=n();return!t(e,r)}catch(e){return!0}}var a="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),a=n({inst:{value:r,getSnapshot:t}}),s=a[0].inst,f=a[1];return i((function(){s.value=r,s.getSnapshot=t,c(s)&&f({inst:s})}),[e,r,t]),o((function(){return c(s)&&f({inst:s}),e((function(){c(s)&&f({inst:s})}))}),[e]),u(r),r};return _.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:a,_}():e.exports=(D||(D=1,"production"!==process.env.NODE_ENV&&function(){"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var e=r.default,t=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function n(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];o("error",e,n)}function o(e,n,r){var o=t.ReactDebugCurrentFrame.getStackAddendum();""!==o&&(n+="%s",r=r.concat([o]));var i=r.map((function(e){return String(e)}));i.unshift("Warning: "+n),Function.prototype.apply.call(console[e],console,i)}var i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},u=e.useState,c=e.useEffect,a=e.useLayoutEffect,s=e.useDebugValue,f=!1,d=!1;function l(e){var t=e.getSnapshot,n=e.value;try{var r=t();return!i(n,r)}catch(e){return!0}}var p="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t,n){return t()}:function(t,r,o){f||void 0!==e.startTransition&&(f=!0,n("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var p=r();if(!d){var v=r();i(p,v)||(n("The result of getSnapshot should be cached to avoid an infinite loop"),d=!0)}var O=u({inst:{value:p,getSnapshot:r}}),b=O[0].inst,y=O[1];return a((function(){b.value=p,b.getSnapshot=r,l(b)&&y({inst:b})}),[t,p,r]),c((function(){return l(b)&&y({inst:b}),t((function(){l(b)&&y({inst:b})}))}),[t]),s(p),p},v=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:p;x.useSyncExternalStore=v,"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()),x)}(S);var T=t.createContext(null),A=["eventType"];function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},C.apply(this,arguments)}var L=t.createContext(null);function V(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.errorMessage,r=void 0===n?"The Predict APIs must be used within the <Predict> provider.":n,o=t.useContext(T);return s(null!==o,r),o}var I=["addZone","removeZone","updateZone","subscribe"];function R(){var e=V({errorMessage:"`usePredict()` must be used within the <Predict> provider."});e.addZone,e.removeZone,e.updateZone,e.subscribe;var n,r,o,u,a=i(e,I);return n=a,r=c(t.useState((function(){return n})),2),o=r[0],u=r[1],P(o,n)||u(n),o}var k=["id","children","name","segment","fallback"];function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}e.Predict=function(e){var n=e.userProfile,o=e.suppressExperimentalWarning,u=void 0!==o&&o,a=e.children,s=t.useRef(null);null===s.current&&(s.current=E({userProfile:n}));var f=c(t.useState((function(){return{userProfile:s.current.getUserProfile(),affinities:s.current.getAffinities(),funnelStage:s.current.getFunnelStage(),orderValue:s.current.getOrderValue(),cartAbandonment:s.current.getCartAbandonment(),segments:s.current.getSegments(),zones:s.current.getZones(),addZone:s.current.addZone,removeZone:s.current.removeZone,updateZone:s.current.updateZone,subscribe:s.current.subscribe}})),2),l=f[0],p=f[1],v=c(t.useState((function(){return s.current.getUserProfile()})),2),O=v[0],b=v[1];P(n,O)||(s.current.update({userProfile:n}),b(n));var y=S.exports.useSyncExternalStore(t.useCallback((function(){return s.current.subscribe((function(e){var t=e.eventType,n=i(e,A);"ZONE_UPDATED"!==t&&p((function(e){return N(N({},e),n)}))}))}),[]),(function(){return l}),(function(){return l}));return t.useEffect((function(){"production"!==process.env.NODE_ENV&&d(u,"This version is experimental and not production-ready.\n\nPlease report any bugs at https://github.com/algolia/predict/issues/new\n\n(To disable this warning, pass `suppressExperimentalWarning` to <Predict>.)")}),[u]),r.default.createElement(T.Provider,{value:y},a)},e.PredictZone=function(e){var n=e.id,o=e.children,u=e.name,s=e.segment,f=e.fallback,d=void 0===f?null:f,l=i(e,k),p=V({errorMessage:"The <PredictZone> must be mounted within the <Predict> provider."}),v=p.addZone,O=p.removeZone,b=p.updateZone,y=R(),g=t.useState((function(){var e="function"==typeof s?s(y):!s||Boolean(y.segments.find((function(e){return e.name===s})));return function(e){var t=e.id,n=e.name,r=e.active,o=void 0===r||r,i=e.happened,u=void 0!==i&&i;return{id:t||"".concat(n,"-").concat(++a.current),name:n,active:o,happened:u}}({id:n,name:u,active:e})})),h=c(g,2),m=h[0],E=h[1],w=c(t.useState(!1),2),P=w[0],j=w[1],_=c(t.useState(m.name),2),D=_[0],x=_[1];if(u!==D&&(x(u),b({id:m.id,name:u})),!P){var T="function"==typeof s?s(y):s?Boolean(y.segments.find((function(e){return e.name===s}))):m.active;T!==m.active&&(E((function(e){return M(M({},e),{},{active:T})})),b({id:m.id,active:T}))}var A=t.useMemo((function(){return{dismissZone:function(){E((function(e){return M(M({},e),{},{active:!1,happened:!0})})),b({id:m.id,active:!1,happened:!0}),j(!0)}}}),[b,m.id]),Z=S.exports.useSyncExternalStore(t.useCallback((function(){return v(m),function(){O(m)}}),[v,O]),(function(){return A}),(function(){return A}));return m.active?r.default.createElement(L.Provider,{value:Z},r.default.createElement("div",C({},l,{"data-predictzoneid":m.id,onMouseDown:function(){E((function(e){return M(M({},e),{},{happened:!0})})),b({id:m.id,happened:!0})},onTouchStart:function(){E((function(e){return M(M({},e),{},{happened:!0})})),b({id:m.id,happened:!0})}}),o)):r.default.createElement(r.default.Fragment,null,d)},e.usePredict=R,e.usePredictZone=function(){var e=t.useContext(L);return s(null!==e,"`usePredictZone()` must be used within a <PredictZone>."),e},e.version="1.4.0",Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.js.map
